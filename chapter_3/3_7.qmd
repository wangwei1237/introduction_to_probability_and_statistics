## 贝叶斯公式 {#sec-3_7}
令 $E$ 和 $F$ 为事件，则我们可以用如下的式子表示 $E$：$E = EF \cup EF^c$。如 @fig-3_6 为了让一个点位于 $E$ 中，要么这个点即位于 $E$ 又位于 $F$ 中，要么这个点位于 $E$ 中但是不位于 $F$ 中。

![$E=EF \cup EF^c$](../images/chapter_3/f_3_6.png){#fig-3_6}

因为 $EF$ 和 $EF^c$ 是互斥的，根据 **公理3** 有：

$$
\begin{align}
P(E)&=P(EF) + P(EF^c) \\
&=P(E|F)P(F) + P(E|F^c)P(F^c) \\
&=P(E|F)P(F) + P(E|F^c)[1 - P(F)]
\end{align}
$$ {#eq-3_7_001}

@eq-3_7_001 表明，事件 $E$ 的概率是 $F$ 发生时 $E$ 发生的条件概率和 $F$ 不发生时 $E$ 发生的条件概率的加权平均数，其中，每个条件概率的权重与它所基于的事件发生的概率相同。@eq-3_7_001 是一个极其有用的公式，因为 @eq-3_7_001 允许我们通过某个事件的先决条件事件是否发生来计算该事件的概率。也就是说，在许多情况下，直接计算事件的概率非常困难，但一旦我们知道某个第二事件是否发生，计算该事件的概率就变得比较简单了。

::: {#exr-3_7_a}
一家保险公司认为人可以分为两类——容易出意外的人和不容易出意外的人。他们的统计数据显示，一个容易出意外的人在固定的 1 年期内某个时间点发生意外的概率是 0.4，而对于一个不容易出意外的人来说，这个概率则降低到了 0.2。如果我们假设 30% 的人容易出意外，那么新购买保险的人在购买保险后一年内发生意外的概率是多少？
:::

::: {#sol-3_7_a}
首先根据新购买保险的人是否容易出意外进行条件化，以获得所需的概率。设 $A_1$ 表示事件：新购买保险的人在购买后一年内会发生意外，设 $A$ 表示新购买保险的人容易出意外事件。因此：$P(A_1)=P(A_1|A)P(A) + P(A_1|A^c)P(A^c) = 0.26$。
:::

在接下来的一系列示例中，我们将展示如何根据新的信息重新评估初始概率。也就是说，我们将展示如何将新信息与初始概率相结合，以获得新的概率。

::: {#exr-3_7_b}
双胞胎可以是同卵双胞胎，也可以是异卵双胞胎。同卵双胞胎，也称为单卵双胞胎，是由一个受精卵分裂成两个遗传上完全相同的胚胎。因此，同卵双胞胎总是拥有相同的基因组。异卵双胞胎，也称为双卵双胞胎，是由两个单独的卵子受精并进入到子宫所形成。异卵双胞胎之间的遗传联系与在不同时间出生的兄弟姐妹一样。洛杉矶某县的一位科学家想知道：目前该县出生的双胞胎中同卵双胞胎的比例，于是他委托该县的一位统计学家来研究这个问题。该统计学家最初要求县里的每家医院记录所有双胞胎的出生情况，并注明这些双胞胎是否是同卵双胞胎。然而，医院告诉她，确定新生双胞胎是否为同卵双胞胎并不是一项简单的任务，因为这需要双胞胎父母的许可，并执行复杂且昂贵的 DNA 研究，但是医院无力承担这些研究费用。经过一些讨论，统计学家只要求医院提供所有双胞胎出生情况的清单数据，并注明这些双胞胎是否是同性别。当统计学家收集到的数据表明，大约 64% 的双胞胎出生时是同性别时，统计学家宣称：大约 28% 的双胞胎是同卵双胞胎。统计学家是怎么得出这个结论的？
:::

::: {#sol-3_7_b}
统计学家认为同卵双胞胎总是同性别，而异卵双胞胎，就像任何一对兄弟姐妹一样，有 $\frac{1}{2}$ 的概率是同性别。设 $I$ 为一对双胞胎是同卵双胞胎的事件，$SS$ 为一对双胞胎是同性别的事件。则，

$$
\begin{align}
P(SS) &= P(SS|I)P(I) + P(SS|I^c)P(I^c) \\
&=1 \cdot P(I) + \frac{1}{2} \cdot \bigg(1 - P(I)\bigg) \\
&= \frac{1}{2} + \frac{1}{2}P(I) \\
&\approx 0.64 \\
\therefore P(I) &\approx 0.28
\end{align}
$$
:::

::: {#exr-3_7_c}
让我们重新思考 @exr-3_7_a，假设一名新购买保险的人在购买保险后一年内发生了意外，则该人属于容易出意外的分类的概率是多少？
:::

::: {#sol-3_7_c}
最初，在购买保险的那一刻，我们假设他有 30% 的几率是属于容易出意外的分类。也就是说，$P(A) = 0.3$。然而，基于他在一年内发生了意外的事实，我们现在需要重新评估他容易出意外的概率：

$$
\begin{align}
P(A|A_1)&=\frac{ P(AA_1) }{ P(A_1) } \\
&= \frac{ P(A)P(A_1|A) }{ P(A_1) } \\
&= \frac{ 0.3 \cdot 0.4 }{ 0.26 } \\
&= 0.4615
\end{align}
$$
:::

::: {#exr-3_7_d}
在回答一个多项选择题时，一个学生要么知道答案，要么猜答案。设 $p$ 为她知道答案的概率，$1-p$ 为她猜答案的概率。假设一个学生猜对的概率是 $\frac{1}{m}$，其中 $m$ 是多项选择题的选项数量。如果一个学生的回答是正确的，那么她知道问题答案的概率是多少？
:::

::: {#sol-3_7_d}
令 $C$ 为事件：该学生回答对了该问题，$K$ 为事件：该学生知道答案，则该学生回答正确时，她知道问题答案的概率为：$P(K|C) = \frac{P(KC)}{P(C)}$。

$$
\begin{align}
\because P(KC) &= P(C|K)P(K) \\
&=1 \cdot p \\
&=p
\end{align}
$$

为了计算最终的概率，我们还需要计算 $P(C)$ （该学生可以回答正确的概率）：
$$
\begin{align}
P(C) &= P(C|K)P(K) + P(C|K^c)P(K^c) \\
&=p + \frac{1}{m} \cdot (1-p) \\
\therefore P(K|C)&= \frac{p}{p + \frac{1}{m} \cdot (1-p)} \\
&=\frac{mp}{1+(m-1)p}
\end{align} 
$$

因此，如果 $m=5$，$p=\frac{1}{2}$，则如果该学生回答正确时，他知道答案的概率为 $\frac{5}{6}$。
:::

::: {#exr-3_7_e}
对于某种疾病的检测而言，实验室的血液检测有 99% 的准确率。然而，该血液检测也会对 1% 的健康受检者产生 “假阳性” 结果（也就是说，如果一个健康的人接受检测，那么检测结果会有 0.01 的概率显示他或她患有该疾病）。如果人群中有 0.5% 的人确实患有这种疾病，那么一个人的检测结果为阳性时，他患有这种疾病的概率是多少？
:::

::: {#sol-3_7_e}
令 $D$ 为事件：受检测的人患有该疾病，$E$ 为事件：检测结果为阳性。则：

$$
\begin{align}
P(D|E) &= \frac{P(DE)}{P(E)} \\
&= \frac{P(E|D)P(D)}{P(E|D)P(D) + P(E|D^c)P(D^c)} \\
&=\frac{0.99 \cdot 0.005}{0.99 \cdot 0.005 + 0.01 \cdot 0.995} \\
&= 0.3322
\end{align}
$$

因此，如果检测结果为阳性，则该人实际上患有该疾病的概率只有 33%。因为血液检测似乎是一种很好的方式，因此很多学生认为这个比例应该会更高，所以他们经常对这个结果感到惊讶。因此是时候提出第二个论点了，尽管第二个论点不如前面的论点严格，但它可能更具启发性。

由于实际患有这种疾病的人口比例为 0.5%，因此平均而言，每 200 个接受检测的人中就有 1 人患有这种疾病。该检测将以 0.99 的概率确认这个人患有疾病。因此，平均而言，每 200 个接受检测的人中，该检测将确认 0.99 人患有疾病。另一方面，在（平均）199 个健康人中，该检测将错误地认为有 $199 \cdot 0.01$ 的人患有疾病。因此，对于该检测确认的患有疾病的每 0.99 个病人而言，平均有 1.99 个健康人被错误地认为患有该疾病。因此，当检测结果显示一个人患病时，其结果是正确的比例是：$\frac{0.99}{0.99 + 1.99}=0.3322$
:::

当需要根据新的信息更新概率时，@eq-3_7_001 非常有用。本章接下来的例子将体现这一点。

::: {#exr-3_7_f}
在刑事调查的某个阶段，负责调查的警官有 60% 的信心认为某个嫌疑人有罪。假设现在发现了新的证据，显示罪犯具有某种特征（如左撇子、秃头、棕色头发等）。如果有 20% 的人具有这种特征，那么如果嫌疑人具有犯罪特征时，警官对嫌疑人有罪的信心应该是多少？
:::

::: {#sol-3_7_f}
令 $G$ 表示事件：嫌疑人有罪，$C$ 表示事件：嫌疑人具有罪犯特征。则：

$$
\begin{align}
P(G|C)&=\frac{P(GC)}{P(C)} \\
\because P(GC) &= P(G)P(C|G) \\
&= 0.6 \cdot 1 \\
&= 0.6 \\
\because P(C) &= P(C|G)P(G) + P(C|G^c)P(G^c) \\
&=1 \cdot 0.6 + 0.2 \cdot 0.4 \\
&=0.68
\end{align}
$$

$P(C|G^c)$ 表示如果嫌疑人实际上是清白的，那么他具有犯罪特征的概率，我们假设该概率和等于具有这种特征的人比例一致，也就是 0.2。于是：$P(G|C) = \frac{0.6}{0.68} = 0.882$。
:::

::: {#exr-3_7_fc}
现在让我们假设犯罪者拥有犯罪特定的可能性为 90%，那么在这种情况下，嫌疑人犯罪的可能性有多大？
:::

::: {#sol-3_7_fc}
在这种情况下，情况与以前相同，只是现在嫌疑人在犯罪的情况下具有该特征的概率是0.9，而不是1。于是：

$$
\begin{align}
P(G|C)&=\frac{P(GC)}{P(C)} \\
\because P(GC) &= P(G)P(C|G) \\
&= 0.6 \cdot 0.9 \\
&= 0.54 \\
\because P(C) &= P(C|G)P(G) + P(C|G^c)P(G^c) \\
&=0.9 \cdot 0.6 + 0.2 \cdot 0.4 \\
&=0.62 \\
\therefore P(G|C) &= \frac{0.54}{0.62} \\
&=0.871
\end{align}
$$
:::

假设 $F_1, F_2, ..., F_n$ 是互斥事件，则 $\bigcup_{i=1}^{n}{F_i} = S$。换句话说，$F_i$ 中有且仅有一个事件会发生。则有：

$$
E = \bigcup_{i=1}^{n}{(EF_i)}
$$

基于 $EF_i$ 为互斥事件的事实，我们有：

$$
\begin{align}
P(E)&=\sum_{i=1}^{n}{P(EF_i)} \\
&=\sum_{i=1}^{n}{\big(P(E|F_i)P(F_i)\big)}
\end{align}
$$ {#eq-3_7_002}

对于 $n$ 个互斥事件而言，@eq-3_7_001 可以泛化为 @eq-3_7_002。@eq-3_7_002 表示在给定一组互斥事件 $F_1,F_2,...,F_n$ 时，我们如何通过 $F_i$ 发生时的 $E$ 的条件概率来计算 $P(E)$。也就是说，$P(E)$ 等于 $P(E|F_i)$ 的加权平均值，其权重为对应的 $F_i$ 发生的概率。

现在假设 $E$ 已经发生，我们希望确定哪一个 $F_j$ 发生了。根据 @eq-3_7_002，我们有：

$$
\begin{align}
P(F_j|E)&=\frac{P(EF_j)}{P(E)} \\
&=\frac{P(E|F_j)P(F_j)}{\sum_{i=1}^{n}{\big(P(E|F_i)P(F_i)\big)}}
\end{align}
$$ {#eq-3_7_003}

@eq-3_7_003 就是 **贝叶斯公式**（*Bayes' formula*），其以英国哲学家 Thomas Bayes 的名字命名。 如果我们把事件 $F_j$ 看作是关于某个主题的可能的“假设”（*hypotheses*），那么 **贝叶斯公式** 可以解释为：如何通过实验的证据来修改实验前对这些假设（$P(F_j)$）的看法。

::: {#exr-3_7_g}
一架飞机失踪了，人们推测它坠毁在三个可能区域的概率是相等的。假设 $1 - \alpha_i$ 表示当飞机确实坠毁在区域 $i$ 时，搜索该区域能发现飞机的概率，其中 $i = 1, 2, 3$。（常数 $\alpha_i$ 被称为 **忽视概率**（*overlook probabilities*），因为它们代表忽视飞机的概率。$\alpha_i$ 通常归因于这些区域的地理和环境条件。在区域 1 没有搜索到飞机的情况下，飞机位于区域 $i$ 的条件概率是多少（$i = 1, 2, 3$）？
:::

::: {#sol-3_7_g}
令 $R_i$ 为事件：飞机位于区域 $i$，令 $E$ 为事件：在区域 1 没有搜索到飞机。根据贝叶斯公式，我们有：

$$
\begin{align}
P(R_1|E)&=\frac{P(ER_1)}{P(E)} \\
&=\frac{P(E|R_1)P(R1)}{\sum_{i=1}^{3}(P(E|R_i)P(R_i))} \\
&=\frac{\alpha_1 \cdot \frac{1}{3}}{\alpha_1 \cdot \frac{1}{3} + 1 \cdot \frac{1}{3} + 1 \cdot \frac{1}{3}} \\
&=\frac{\alpha_1}{\alpha_2 + 2} \\
For\ j=&2,3: \\
P(R_j|E)&=\frac{P(E|R_j)P(R_j)}{P(E)} \\
&=\frac{1 \cdot \frac{1}{3}}{\alpha_1 \cdot \frac{1}{3} + \frac{1}{3} + \frac{1}{3}} \\
&=\frac{1}{\alpha_1 + 2}
\end{align}
$$

因此，例如，如果 $\alpha_1$ = 0.4，那么在该区域搜索后未发现飞机的情况下，飞机位于区域 1 的条件概率为 $\frac{1}{6}$，而飞机位于区域 2 和区域 3 的条件概率都等于 $\frac{1}{2.4}=\frac{5}{12}$。
:::
