## 条件概率 {#sec-3_6}
在本节中，我们将介绍概率论中最重要的概念之一 ——**条件概率**（*conditional probability*）。**条件概率** 的重要性体现在两个方面。首先，当涉及到实验结果的部分信息可用时，或者需要根据额外信息重新计算概率时，我们经常需要利用 **条件概率** 来计算概率。其次，事实证明，计算事件概率的最简单的方法通常是以另一事件是否发生作为先决条件。

如下是一个 **条件概率** 的例子：假设某人抛了一对骰子，该实验的样本空间 $S$ 可以看作是以下 36 个结果的集合：

$$
S = \{(i, j), \ \ i,j \in [1,6] \}
$$

当第一个骰子为 $i$ 点并且第二个骰子为 $j$ 点时，我们称对应的实验结果为 $(i,j)$。假设这 36 个结果发生的可能性都是一样的，则其概率为 $\frac{ 1 }{ 36 }$。接下来，我们观察到第一个骰子的点数是 3，那么在这种情况下，两个骰子的点数之和为 8 的概率是多少？为了计算概率，我们做如下的推理：

* 在第一个骰子的点数是 3 的情况下，我们的实验结果最多有 6 种可能：(3,1)，(3,2)，(3,3)，(3,4)，(3,5)，(3,6)。
* 因为每种结果出现的概率都是相同的，因此在第一个骰子为 3 点的条件下，其 6 种可能出现的结果的每种结果出现的概率都是 $\frac{ 1 }{ 6 }$。
* 因此，两个骰子的点数之和为 8 的结果为 (3, 5)，其概率为 $\frac{ 1 }{ 6 }$。

如果我们令 $E$ 表示两个骰子的点数之和为 8 这一事件，令 $F$ 表示第一个骰子的点数为 3 这一事件，则我们刚才获取到的概率称之为在 $F$ 发生的条件下，$E$ 的 **条件概率**，并记作 $P(E|F)$。

作为一个通用的公式，$P(E|F)$ 可以应用于所有的事件 $E$ 和 $F$。具体来说，如果事件 $F$ 发生，那么为了使得 $E$ 也发生，则实际发生的事件必须同时位于 $E$ 和 $F$ 中，也就是说，必须在 $EF$ 中。然而，由于我们知道 $F$ 已经发生，因此我们可以将 $F$ 视为新的样本空间，因此事件 $P(E|F)$ 发生的概率将等于 $EF$ 相对于 $F$ 的概率。即：

$$
p(E|F)=\frac{ P(EF) }{ P(F) }
$$ {#eq-3_6_001}

如 @fig-3_5 所示，仅当 $P(F) > 0$ 时，@eq-3_6_001 才有意义，这意味着，当且仅当 $P(F) > 0$ 时，$P(E|F)$ 才有意义。

![$P(E|F)=\frac{ EF }{ F }$](../images/chapter_3/f_3_5.png){#fig-3_5}

@eq-3_6_001 给出的条件概率的定义与在大量重复试验下使用相对频率作为概率的解释是一致的。为了理解这一点，假设重复执行实验 $n$ 次，由于 $P(F)$ 是多次执行条件下 $F$ 发生的比例，因此 $F$ 大约会发生 $n \cdot P(F)$ 次。类似地，在实验中，大约有 $n \cdot P(EF)$ 次实验会出现 $E$ 和 $F$ 都发生的情况。因此，在大约 $n \cdot P (F)$ 次 $F$ 发生的实验中，大约有 $n \cdot P(EF)$ 次 $E$ 也会发生。也就是说，对于那些结果属于事件 $F$ 的实验，其结果也属于事件 $E$ 的比例大约是：$\frac{ n \cdot P(EF) }{ n \cdot P(F) } = \frac{ P(EF) }{ P(F) }$。

由于当 $n$ 变得越来越大时，如上的近似计算会变得越来越精确，因此 @eq-3_6_001 给出了在 $F$ 已经发生的情况下 $E$ 也发生的 **条件概率** 的适当定义。

::: {#exr-3_6_a}
一个箱子里有 40 个晶体管，其中有 5 个残品（一开始就无法使用），10 个次品（使用几个小时后才无法使用），以及 25 个合格品。从箱子里随机选取一个晶体管并投入使用，如果该晶体管没有立即失效，那么它是合格品的概率是多少？
:::

::: {#sol-3_6_a}
因为抽取的晶体管没有立即失效，因此该晶体管不属于 5 个残品，因此待求解的概率为：

$$
\begin{align}
P(合格品|非残品) &= \frac{ P(合格品, 非残品) }{ P(非残品) } \\
&= \frac{ P(合格品) }{ P(非残品) } \\
&= \frac{ \frac{ 25 }{ 40 } }{ \frac{ 35 }{ 40 } } \\
&= \frac{ 5 }{ 7 }
\end{align}
$$

应该注意的是，我们也可以通过直接处理缩减后的样本空间来获得结果。也就是说，由于我们知道所选的晶体管不是残品，问题就简化为：从包含 25 个合格品和 10 个次品的箱子中随机选择一个晶体管，该晶体管是合格品的概率是多少？显然，概率等于 $\frac{ 25 }{ 35 }$。
:::

::: {#exr-3_6_b}
琼斯所在的部门正在为那些至少有一个儿子的员工举办一场父子晚宴。这些员工都将受邀参加该晚宴，并会带上他们最小的儿子一起参加晚宴。如果已知琼斯有两个孩子，那么在他受邀参加晚宴的条件下，他的两个孩子都是男孩的概率是多少？假设样本空间为 $S$ 且 $S =\{(b,b),(b,g),(g,b),(g,g)\}$，同时所有结果出现的可能性都相等（例如，$(b,g)$ 表示较小的孩子是男孩，较大的孩子是女孩）。
:::

::: {#sol-3_6_b}
琼斯受邀参加晚宴这一事实相当于知道他至少有一个儿子。因此，设 $B$ 为两个孩子都是男孩的事件，$A$ 为至少有一个孩子是男孩的事件，我们要求的概率 $P(B|A)$ 为：$P(B|A)=\frac{ P(AB) }{ P(A) }$ $=$ $\frac{ P(\{(b, b)\}) }{ P(\{(b, b), (b, g), (g, b)\}) }$ $=$ $\frac{ \frac{ 1 }{ 4 } }{ \frac{ 3 }{ 4 } }$ $=$ $\frac{ 1 }{ 3 }$。

许多读者错误地认为，在至少有一个男孩的条件下，有两个男孩的概率是 $\frac{1}{2}$，而不是正确答案 $\frac{1}{3}$。因为他们认为琼斯无法参加晚宴等价于其孩子是男孩或女孩的概率。然而，这个假设本身就是错误的。务必记住，最初有四种等可能的结果，现在，至少有一个孩子是男孩的信息等价于知道结果不是 $(g, g)$。因此，我们只剩下三种等可能的结果：$(b, b)$、$(b, g)$、$(g, b)$，从而表明琼斯参加晚宴时其另外一个孩子为女孩的可能性是为男孩的两倍。
:::

对 @eq-3_6_001 的两边都乘以 $P(F)$，我们得到：

$$
P(EF) = P(F) \cdot P(E|F)
$$ {#eq-3_6_002}

@eq-3_6_002 表明事件 $E$ 和 $F$ 同时发生的概率等于 $F$ 发生的概率乘以在 $F$ 发生条件下 $E$ 发生的条件概率。在计算事件交集的概率时，@eq-3_6_002 通常非常有用。@exr-3_6_c 所示的例子说明了这一点。

::: {#exr-3_6_c}
佩雷斯女士估计，她所在的公司有 30% 的可能性会在菲尼克斯设立分公司。如果设立了公司真的在菲尼克斯设立分公司，她有 60% 的把握让公司任命其为新的分公司的经理。那么，佩雷斯女士成为菲尼克斯分公司经理的概率是多少？
:::

::: {#sol-3_6_c}
令 $B$ 表示公司会在菲尼克斯设立分公司，$M$ 表示任命佩雷斯女士为新的分公司的经理，则待求解的概率为 $P(BM)$，根据 @eq-3_6_002 有：$P(BM) = P(B)P(M|B) = 0.3 \cdot 0.6 = 0.18$。因此，佩雷斯女士有 18% 的概率成为菲尼克斯分公司的经理。
:::