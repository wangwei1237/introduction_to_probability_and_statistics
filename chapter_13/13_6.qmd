## 用于检测总体均值变化的控制图 {#sec-13_6}
@sec-13_2 中给出的 $\overline{X}$-控制图 的主要缺点在于对总体均值的微小变化不敏感。也就是说，当总体均值出现较小的变化时，由于图中的每个点仅依赖于单个子组，因此往往具有相对较大的方差，所以需要大量的数据点才能检测到总体均值出现的较小的变化。为了解决这个问题，可以让图中的每个数据点不仅取决于最近的子组均值，还取决于其他子组均值。目前，有三种方法可以实现该目的：

1. 移动平均控制图（*moving averages*）
2. 指数加权移动平均控制图（*exponentially weighted moving averages*）
3. 累计和控制图（*cumulative sum*）

### 移动平均控制图 {#sec-13_6_1}
通过不断绘制最近 $k$ 个子组的平均值可以得到跨度为 $k$ 的移动平均控制图。也就是说，在 $t$ 时刻的移动平均值 $M_t$ 为：

$M_t=\frac{\overline{X}_t+\overline{X}_{t - 1}+\cdots+\overline{X}_{t - k + 1}}{k}$

其中 $\overline{X}_i$ 是第 $i$ 个子组的平均值，并且：

$kM_t=\overline{X}_t+\overline{X}_{t - 1}+\cdots+\overline{X}_{t - k + 1}$

$kM_{t + 1}=\overline{X}_{t + 1}+\overline{X}_t+\cdots+\overline{X}_{t - k + 2}$

于是，$kM_{t + 1}-kM_t$ 得到：

$kM_{t + 1}-kM_t=\overline{X}_{t + 1}-\overline{X}_{t - k + 1}$

即：

$M_{t + 1}=M_t+\frac{\overline{X}_{t + 1}-\overline{X}_{t - k + 1}}{k}$

换句话说，$t + 1$ 时刻的移动平均值等于 $t$ 时刻的移动平均值加上 $1/k$ 乘以移动平均值中新添加的值（$\overline{X}_{t + 1}$）与需要删除的值（$\overline{X}_{t - k + 1}$）之间的差值。当 $t$ 小于 $k$ 时，$M_t$ 定义为前 $t$ 个子组的平均值，即：

$M_t=\frac{\overline{X}_1+\cdots+\overline{X}_t}{t} , \quad \text{如果} t < k$ 

假设当 **过程** 处于受控状态时，连续样本数据来自均值为 $\mu$、方差为 $\sigma^{2}$ 的正态总体。因此，如果子组大小为 $n$，那么 $\overline{X}_{i}$ 服从均值为 $\mu$、方差为 $\sigma^{2}/n$ 的正态分布。由此可知，$m$ 个 $\overline{X}_{i}$ 的平均值将服从均值为 $\mu$、方差为 $\text{Var}(\overline{X}_{i})/m=\sigma^{2}/nm$ 的正态分布。所以，当 **过程** 处于受控状态时：

$$
\begin{align}
E[M_{t}]&=\mu \\
\text{Var}(M_{t}) &= 
\begin{cases}
\sigma^{2}/nt & \text{如果 } t < k \\
\sigma^{2}/nk & \text{否则}
\end{cases}
\end{align}
$$

因为正态随机变量几乎总是位于其均值的 3 个标准差内，所以对于 $M_{t}$，我们有以下上、下控制限：

$$
\begin{align}
\text{UCL} &= 
\begin{cases}
\mu + 3\sigma/\sqrt{nt} & \text{如果 } t < k \\
\mu + 3\sigma/\sqrt{nk} & \text{否则}
\end{cases} \\ 
\text{LCL} &= 
\begin{cases}
\mu - 3\sigma/\sqrt{nt} & \text{如果 } t < k \\
\mu - 3\sigma/\sqrt{nk} & \text{否则}
\end{cases}
\end{align}
$$

换句话说，除了前 $k - 1$ 个移动平均值之外，每当移动平均值与 $\mu$ 的差值超过 $3\sigma/\sqrt{nk}$ 时，就可以判定 **过程** 处于失控状态。

::: {#exm-13_6_a}
当某制造商的生产 **过程** 处于受控状态时，其所生产的产品的某测量值服从均值为 10、标准差为 2 的正态分布。以下的模拟数据表示来自均值为 11、标准差为 2 的正态总体的 25 个子组（每个子组大小为 5）的平均值。也就是说，这些数据表示 **过程** 失控后，其均值从 10 增加到 11 时的子组平均值。@tbl-13_3 给出了这 25 个子组的平均值，以及当 $k = 8$ 时的移动平均值和上下控制限。对于 $t>8$，下控制限和上控制限分别为 9.051318 和 10.94868。

| $t$ | $\overline{X}_t$ | $M_t$ | $LCL$ | $UCL$ |
| ---- | ---- | ---- | ---- | ---- |
| 1 | 9.617728 | 9.617728 | 7.316719 | 12.68328 |
| 2 | 10.25437 | 9.936049 | 8.102634 | 11.89737 |
| 3 | 9.876195 | 9.913098 | 8.450807 | 11.54919 |
| 4 | 10.79338 | 10.13317 | 8.658359 | 11.34164 |
| 5 | 10.60699 | 10.22793 | 8.8 | 11.2 |
| 6 | 10.48396 | 10.2706 | 8.904554 | 11.09545 |
| 7 | 13.33961 | 10.70903 | 8.95815 | 11.01419 |
| 8 | 9.462969 | 10.55328 | 9.051318 | 10.94868 |
| 9 | 10.14556 | 10.61926 |  |  |
| 10 | 11.66342 | 10.79539 |  |  |
| *11 | 11.55484 | 11.00634 |  |  |
| *12 | 11.26203 | 11.06492 |  |  |
| *13 | 12.31473 | 11.27839 |  |  |
| *14 | 9.220009 | 11.1204 |  |  |
| 15 | 11.25206 | 10.85945 |  |  |
| 16 | 10.48662 | 10.98741 |  |  |
| 17 | 9.025091 | 10.84735 |  |  |
| 18 | 9.693386 | 10.6011 |  |  |
| 19 | 11.45989 | 10.58923 |  |  |
| 20 | 12.44213 | 10.73674 |  |  |
| 21 | 11.18981 | 10.59613 |  |  |
| 22 | 11.56674 | 10.88947 |  |  |
| 23 | 9.869849 | 10.71669 |  |  |
| 24 | 12.11311 | 10.92 |  |  |
| *25 | 11.48656 | 11.22768 |  |  |
: * 表示过程失控 {#tbl-13_3}

如表所示，第一个超出其控制限的移动平均值出现在 $t=11$，其他类似情况出现在 12、13、14、16 和 25。有趣的是，通常的控制图——即 $k = 1$ 的移动平均值——会在 $t=7$ 时判定 **过程** 失控，因为 $\overline{X}_{7}$ 非常大。然而，这是该图唯一会表明 **过程** 失控的点（见 @fig-13_3）。

```{r}
#| label: fig-13_3
#| fig-cap: $\overline{X}$-控制图
#| warning: false

library(ggplot2)

x <- c(9.617728, 10.25437, 9.876195, 10.79338, 10.60699, 10.48396, 13.33961, 9.462969, 10.14556, 
       11.66342, 11.55484, 11.26203, 12.31473, 9.220009, 11.25206, 10.48662, 9.025091, 9.693386, 
       11.45989, 12.44213, 11.18981, 11.56674, 9.869849, 12.11311, 11.48656)
i <- seq_along(x)
df <- data.frame(i=i, x=x)

mu <- 10       # 均值
sigma <- 2  # 标准差
n <- 5        # 子组样本量

UCL <- mu + 3 * sigma / sqrt(n)  # 上控制限
LCL <- mu - 3 * sigma / sqrt(n)  # 下控制限

ggplot(df, aes(x = i, y = x)) +
  geom_point(shape = 4, size = 2) +  # 绘制均值点
  geom_hline(yintercept = UCL, color = "blue", linetype = "dashed", size = 1) +  # 上控制限
  geom_hline(yintercept = LCL, color = "blue", linetype = "dashed", size = 1) +  # 下控制限
  annotate("text", x = 11, y = UCL, label = "UCL", hjust = 0, vjust = -0.5, color = "blue") +  # 标注UCL
  annotate("text", x = 11, y = LCL, label = "LCL", hjust = 0, vjust = 1.5, color = "blue") +  # 标注LCL
  scale_x_continuous(limits = c(1, 25),
                     breaks = seq(1, 25, by = 1)) + 
  theme_minimal()  # 使用简洁主题
```

均值变化大小与合适的移动平均跨度大小 $k$ 之间往往存在负相关性。也就是说，均值变化越小，$k$ 的取值应该越大。$\blacksquare$
:::

### 指数加权移动平均控制图 {#13_6_2}
@sec-13_6_1 中的 **移动平均控制图** 在每个 $t$ 时刻都考虑了到该时刻为止的所有子组平均值的加权平均值，其中最近的 $k$ 个子组的权重为 $1/k$ ，其他子组的权重为 0。这似乎是检测总体均值微小变化的最有效的方式，所以也引发了对其他可能性的思考——采用其他的权重来计算加权平均值。

令

$$
W_t=\alpha\overline{X}_t+(1 - \alpha)W_{t - 1}
$$ {#eq-13_6_1}

其中 $\alpha$ 是介于 0 和 1 之间的常数，并且

$W_0=\mu$

我们称 $W_t, t = 0,1,2,\cdots$ 为 **指数加权移动平均值**。为了理解为什么要如此称呼这个序列，我们需要注意到：如果不断地用@eq-13_6_1 替换该式右侧的 $W$，我们会得到：

$$
\begin{align*}
W_t&=\alpha\overline{X}_t+(1 - \alpha)[\alpha\overline{X}_{t - 1}+(1 - \alpha)W_{t - 2}] \\
&=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+(1 - \alpha)^2W_{t - 2}\\
&=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+(1 - \alpha)^2[\alpha\overline{X}_{t - 2}+(1 - \alpha)W_{t - 3}]\\
&=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+\alpha(1 - \alpha)^2\overline{X}_{t - 2}+(1 - \alpha)^3W_{t - 3}\\
&\vdots\\
&=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+\alpha(1 - \alpha)^2\overline{X}_{t - 2}+\cdots\\
&+\alpha(1 - \alpha)^{t - 1}\overline{X}_1+(1 - \alpha)^t\mu
\end{align*}
$$ {#eq-13_6_2}

因此，从 @eq-13_6_2 中，我们可以看出，$W_t$ 是到 $t$ 时刻为止所有子组平均值的加权平均值，最近的子组的权重为 $\alpha$，然后对于之后的子组不停的乘以 $1 - \alpha$ 以持续降低其对应子组的权重，最后受控总体均值的权重为 $(1 - \alpha)^t$。

$\alpha$ 的值越小，后续子组的权重就越均匀。例如，如果 $\alpha = 0.1$，那么初始权重是 0.1，后续权重以 0.9 为因子不断减小；也就是说，权重依次是 $0.1, 0.09, 0.081, 0.073, 0.066, 0.059, \cdots$。另一方面，如果 $\alpha = 0.4$，那么权重将依次是 $0.4, 0.24, 0.144, 0.087, 0.052, \cdots$。 

由于权重 $\alpha(1 - \alpha)^{i - 1}, i = 1, 2, \cdots$ ，可以写成

$\alpha(1 - \alpha)^{i - 1}=\overline{\alpha}e^{-\beta i}$

其中，$\overline{\alpha}=\frac{\alpha}{1 - \alpha}, \quad \beta = -\log(1 - \alpha)$

所以，我们说数据是通过连续的“指数加权” 所得到的。（见 @fig-13_4）。 

```{r}
#| label: fig-13_4
#| fig-cap: 当$\alpha=0.4$时$\alpha(1-\alpha)^{i-1}$的函数图
#| warning: false
#| 

# 设置alpha值
alpha <- 0.4
# 生成i的序列，这里从1到10
i <- seq(1, 10, 0.1)
# 计算权重
weights <- alpha * (1 - alpha)^(i - 1)
# 绘制图形
plot(i, weights, type = "l", lty = 1, lwd = 2, col = "blue",
     xlab = "i",
     ylab = expression(alpha * (1 - alpha)^(i - 1)))
```

为了计算 $W_t$ 的均值和方差，我们需要回想一下：当 **过程** 处于受控状态时，子组平均值 $\overline{X}_i$ 是相互独立的正态随机变量，并且每个子组的平均值的均值为 $\mu$、方差为 $\sigma^{2}/n$。因此，使用 @eq-13_6_2，有：

$$
\begin{align*}
E[W_t]&=\mu[\alpha+\alpha(1 - \alpha)+\alpha(1 - \alpha)^2+\cdots+\alpha(1 - \alpha)^{t - 1}+(1 - \alpha)^t]\\
&=\frac{\mu\alpha[1-(1 - \alpha)^t]}{1-(1 - \alpha)}+\mu(1 - \alpha)^t\\
&=\mu
\end{align*}
$$

再次使用 @eq-13_6_2 以确定方差：

$$
\begin{align*}
\text{Var}(W_t)&=\frac{\sigma^{2}}{n}\left\{\alpha^{2}+[\alpha(1 - \alpha)]^{2}+[\alpha(1 - \alpha)^2]^{2}+\cdots+[\alpha(1 - \alpha)^{t - 1}]^{2}\right\}\\
&=\frac{\sigma^{2}}{n}\alpha^{2}[1+\beta+\beta^{2}+\cdots+\beta^{t - 1}] \quad \text{其中 } \beta=(1 - \alpha)^2\\
&=\frac{\sigma^{2}\alpha^{2}[1-(1 - \alpha)^{2t}]}{n[1-(1 - \alpha)^2]}\\
&=\frac{\sigma^{2}\alpha[1-(1 - \alpha)^{2t}]}{n(2 - \alpha)}
\end{align*}
$$

因此，当 $t$ 很大时，只要 **过程** 始终保持在受控状态：

$$
\begin{align*}
E[W_t]&=\mu\\
\text{Var}(W_t)&\approx\frac{\sigma^{2}\alpha}{n(2 - \alpha)} \quad \text{因为 } (1 - \alpha)^{2t}\approx0
\end{align*}
$$

因此，$W_t$ 的上、下控制限由以下公式给出：

$$
\begin{align*}
\text{UCL}&=\mu + 3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}\\
\text{LCL}&=\mu - 3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}
\end{align*}
$$

注意，当指数加权移动平均控制图的控制限与跨度为 $k$ 的移动平均控制图（在初始的 $k$ 个值之后）中的控制限相同时：

$$
\frac{3\sigma}{\sqrt{nk}}=3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}
$$

即，

$$
k=\frac{2 - \alpha}{\alpha} \quad \text{或} \quad \alpha=\frac{2}{k + 1} 
$$

::: {#exr-13_6_b}
一家维修店会派一名工人前往预约者家中维修电子设备。收到维修电话后，维修店会派遣一名工人，该工人在完成维修工作后需要电话汇报维修情况。历史数据表明，从派遣维修人员到其电话汇报之间的时间服从正态分布，其均值为 62 分钟，标准差为 24 分钟。为了关注从派遣维修人员到其电话汇报之间的时间的任何变化，该维修店绘制了一张标准的指数加权移动平均（*EWMA*）控制图，图中每个数据点是连续 4 次维修时间的平均值，且加权因子 $\alpha = 0.25$。如果该控制图的当前值为 60，并且以下是接下来的 16 个子组平均值，我们能得出什么结论？ 

48, 52, 70, 62, 57, 81, 56, 59, 77, 82, 78, 80, 74, 82, 68, 84
:::

::: {#sol-13_6_b}
从 $W_0 = 60$ 开始，可以根据公式：

$W_t = 0.25\overline{X}_t + 0.75W_{t - 1}$

计算得到 $W_1,\cdots,W_{16}$ 的连续值。

计算结果如下：

$$
\begin{align*}
W_1&=(0.25)(48)+(0.75)(60)=57\\
W_2&=(0.25)(52)+(0.75)(57)=55.75\\
W_3&=(0.25)(70)+(0.75)(55.75)=59.31\\
W_4&=(0.25)(62)+(0.75)(59.31)=59.98\\
W_5&=(0.25)(57)+(0.75)(59.98)=59.24\\
W_6&=(0.25)(81)+(0.75)(59.24)=64.68
\end{align*}
$$

以此类推，$W_7$ 到 $W_{16}$ 的值如下：

$62.50, 61.61, 65.48, 69.60, 71.70, 73.78, 73.83, 75.87, 73.90, 76.43$

因为 $3\sqrt{\frac{0.25}{1.75}}\frac{24}{\sqrt{4}} = 13.61$，因此在加权因子 $\alpha = 0.25$ 时的指数加权移动平均（*EWMA*）控制图的控制限为：

$$
\begin{align*}
\text{LCL}&=62 - 13.61 = 48.39\\
\text{UCL}&=62 + 13.61 = 75.61
\end{align*}
$$

因此，根据 EWMA 控制图，我们会判断在 $W_{14}$（以及 $W_{16}$）之后，系统将处于失控状态。另一方面，有趣的是，子组标准差为 $\sigma/\sqrt{n}=12$，但是没有任何一个数据与 $\mu = 62$ 之间的差距超过了 2 个标准差，所以标准的 $\overline{X}$-控制图并不会判定系统失控。$\blacksquare$
:::

::: {#exm-13_6_c}
对于 @exm-13_6_a 中的数据，如果使用 $\alpha=\frac{2}{9}$ 的 EWMA 控制图，我们得到如下的数据(*表示失控)。

| $t$ | $\overline{X}_t$ | $W_t$ | $t$ | $\overline{X}_t$ | $W_t$ |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 1 | 9.617728 | 9.915051 | 14 | 9.220009 | 10.84522 |
| 2 | 10.25437 | 9.990456 | 15 | 11.25206 | 10.93563 |
| 3 | 9.867195 | 9.963064 | 16 | 10.48662 | 10.83585 |
| 4 | 10.79338 | 10.14758 | 17 | 9.025091 | 10.43346 |
| 5 | 10.60699 | 10.24967 | 18 | 9.693386 | 10.269 |
| 6 | 10.48396 | 10.30174 | 19 | 11.45989 | 10.53364 |
| *7 | 13.33961 | 10.97682 | *20 | 12.44213 | 10.95775 |
| 8 | 9.462969 | 10.64041 | *21 | 11.18981 | 11.00932 |
| 9 | 10.14556 | 10.53044 | *22 | 11.56674 | 11.13319 |
| 10 | 11.66342 | 10.78221 | 23 | 9.869849 | 10.85245 |
| *11 | 11.55484 | 10.95391 | *24 | 12.11311 | 11.13259 |
| *12 | 11.26203 | 11.02238 | *25 | 11.48656 | 11.21125 |
| *13 | 12.31473 | 11.30957 |  |  |  |

```{r}
#| label: fig-13_5
#| fig-cap: "移动平均控制图"
#| warning: false
#| 

library(ggplot2)

x <- c(9.915051, 9.990456, 9.963064, 10.14758, 10.24967, 10.30174, 10.97682, 10.64041, 10.53044, 
       10.78221, 10.95391, 11.02238, 11.30957, 10.84522, 10.93563, 10.83585, 10.43346, 10.269, 
       10.53364, 10.95775, 11.00932, 11.13319, 10.85245, 11.13259, 11.21125)
i <- seq_along(x)
df <- data.frame(i=i, x=x)

UCL <- 10.94868  # 上控制限
LCL <- 9.051318  # 下控制限

ggplot(df, aes(x = i, y = x)) +
  geom_point(shape = 4, size = 2) +  # 绘制均值点
  geom_hline(yintercept = UCL, color = "blue", linetype = "dashed", size = 1) +  # 上控制限
  geom_hline(yintercept = LCL, color = "blue", linetype = "dashed", size = 1) +  # 下控制限
  annotate("text", x = 11, y = UCL, label = "UCL", hjust = 0, vjust = -0.5, color = "blue") +  # 标注UCL
  annotate("text", x = 11, y = LCL, label = "LCL", hjust = 0, vjust = 1.5, color = "blue") +  # 标注LCL
  scale_x_continuous(limits = c(1, 25),
                     breaks = seq(1, 25, by = 1)) + 
  theme_minimal()  # 使用简洁主题
```

因为 $\text{UCL} = 10.94868, \text{LCL}=9.051318$，因此，根据 @fig-13_5，当 $t=7$ 时，**过程** 就开始处于失控状态。$\blacksquare$
:::

### 累计和控制图 {#sec-13_6_3}
在检测较小的均值变化或者中等规模的均值变化方面，累计和（通常简称为 cu-sum）控制图也是一种较为有效的检测方法。

假设 $\overline{X}_1, \overline{X}_2, \cdots$ 表示大小为 $n$ 的子组的连续平均值，并且当 **过程** 处于受控状态时，这些随机变量的均值为 $\mu$，标准差为 $\sigma/\sqrt{n}$。最初，假设我们只对检测均值何时增加感兴趣。（单边）累计和控制图可用于检测均值增加的场景，其运作方式如下：

选择大于 0 的常数 $d$ 和 $B$ ，并令

$Y_j = \overline{X}_j - \mu - d\sigma/\sqrt{n}, \quad j\geq1$

注意，当 **过程** 处于受控状态时，$E[\overline{X}_j] = \mu$ ，所以

$E[Y_j] = -d\sigma/\sqrt{n} < 0$

现在，令

$\begin{align*} S_0 &= 0\\ S_{j + 1} &= \max\{S_j + Y_{j + 1}, 0\}, \quad j\geq0 \end{align*}$

参数为 $d$ 和 $B$ 的累计和控制图会持续绘制 $S_j$，并在满足 $S_j > B\sigma/\sqrt{n}$ 的第一个 $j$ 时判断均值已经增加。

为了理解这个控制图背后的原理，假设我们决定持续绘制到目前为止观察到的所有随机变量 $Y_i$ 的总和。也就是说，假设我们决定绘制 $P_j$ 序列，其中

$P_j = \sum_{i = 1}^{j}Y_i$ 或者 $\begin{align*} P_0 &= 0\\ P_{j + 1} &= P_j + Y_{j + 1}, \quad j\geq0 \end{align*}$

当系统一直处于受控状态时，所有的 $Y_i$ 的期望值均为负数，因此我们会期望 $P_j$ 为负数。因此，如果 $P_j$ 的值变得很大——比如说，大于 $B\sigma/\sqrt{n}$——那么这将是 **过程** 失控的有力证据。然而，问题在于，如果系统在很长时间后才失控，那么那时 $P_j$ 的值很可能是非常小的负数（因为在失控之前我们一直在对均值为负数的随机变量求和），因此需要经过很长的时间才能令 $P_j$ 的值超过 $B\sigma/\sqrt{n}$。因此，为了在 **过程** 处于受控状态时避免 $P_j$ 变成非常小的负数，累计和控制图采用了一个简单的技巧：每当 $P_j$ 变为负数时就将其重置为 0。也就是说，$S_j$ 是直到时间 $j$ 为止所有 $Y_i$ 的累计和（但是，每当所有 $Y_i$ 的累计总和小于 0 时，$S_j$ 将被重置为 0）。

::: {#exm-13_6_d}
假设子组平均值的均值、标准差分别为 $\mu = 30$、$\sigma/\sqrt{n}=8$，考虑绘制参数 $d = 0.5$，$B = 5$ 的累计和控制图。如果前八个子组的平均值为 29, 33, 35, 42, 36, 44, 43, 45，

那么 $Y_j=\overline{X}_j - 30 - 4=\overline{X}_j - 34$ 为：

$Y_1=-5$，$Y_2=-1$，$Y_3 = 1$，$Y_4 = 8$，$Y_5 = 2$，$Y_6 = 10$，$Y_7 = 9$，$Y_8 = 11$

因此，

$$
\begin{align*}
S_1&=\max\{-5, 0\}=0\\
S_2&=\max\{-1, 0\}=0\\
S_3&=\max\{1, 0\}=1\\
S_4&=\max\{9, 0\}=9\\
S_5&=\max\{11, 0\}=11\\
S_6&=\max\{21, 0\}=21\\
S_7&=\max\{30, 0\}=30\\
S_8&=\max\{41, 0\}=41
\end{align*}
$$

由于控制限为 $B\sigma/\sqrt{n}=5\times(8)=40$，因此根据累计和控制图，在观察到第八个子组的平均值后会，我们将判断均值已经增加。$\blacksquare$
:::

为了检测均值的正向或负向变化，我们可以同时使用两个单边累计和控制图。首先，$E[X_i]$ 的减小等价于 $E[-X_i]$ 的增加，因此，我们可以通过对子组平均值的负值运行单边累计和控制图来检测产品均值的减小。也就是说，对于指定的参数 $d$ 和 $B$，我们不仅要像之前那样绘制量 $S_j$，而且还令

$W_j = -\overline{X}_j - (-\mu) - d\sigma/\sqrt{n}=\mu - \overline{X}_j - d\sigma/\sqrt{n}$

并且，$\begin{align*} T_0&=0\\ T_{j + 1}&=\max\{T_j + W_{j + 1}, 0\}, \quad j\geq0 \end{align*}$

然后也绘制 $T_j$ 的值。

当 $S_j$ 或 $T_j$ 首次超过 $B\sigma/\sqrt{n}$ 时，就判定 **过程** 失控。

总之，用于检测所生产产品的均值变化的累计和控制图的步骤如下：

1. 选择大于 0 的常数 $d$ 和 $B$
2. 使用连续的子组平均值来确定 $S_j$ 和 $T_j$
3. 当 $S_j$ 或 $T_j$ 首次超过 $B\sigma/\sqrt{n}$ 时，则判定 **过程** 失控

$d$ 和 $B$ 的取值一般有 3 种：

1. $d = 0.25$，$B = 8.00$
2. $d = 0.50$，$B = 4.77$
3. $d = 1$ ，$B = 2.49$

如上的任何一种选择所产生的控制规则的误报率都与在子组平均值与 $\mu$ 的差值首次超过 $3\sigma/\sqrt{n}$ 时就判定 **过程** 失控的 $\overline{X}$-控制图大致相同。作为一个通用的经验法则，当想要防范的均值变化越小时，所选的 $d$ 值就应该越小。