## 符号检验 {#sec-12_2}
令 $X_1,\ldots,X_n$ 表示来自连续分布 $F$ 的一个样本，假设我们希望检验假设：$F$ 的中位数——$m$——等于某个特定值 $m_0$。也就是说，考虑检验如下的假设：

$H_0:m = m_0 \quad vs \quad H_1:m\neq m_0$，其中 $m$ 满足 $F(m)=0.5$。

我们注意到每个观测数据独立小于 $m_0$ 的概率为 $F(m_0)$。因此，如果令 

$I_i=\begin{cases}1& \text{如果} X_i\lt m_0\\0& \text{如果} X_i\geq m_0\end{cases}$ 

那么 $I_1,\ldots,I_n$ 就是是相互独立的伯努利随机变量，并且其参数为 $p = F(m_0)$。所以原假设等价于说该伯努利分布的参数等于 $\frac{1}{2}$。

如果令 $\sum_{i = 1}^{n}I_i$ 的观测值为 $v$，也就是说，$v$ 是观测数据中小于 $m_0$ 的数量，那么根据 @sec-8_6，检验这个伯努利参数等于 $\frac{1}{2}$ 的 $p-\text{value}$ 为 

$$
p-\text{value}=2\min(P\{B(n,\frac{1}{2})\leq v\},P\{B(n,\frac{1}{2})\geq v\})
$$ {#eq-12_2_1} 

其中 $B(n,p)$ 是参数为 $n$ 和 $p$ 的二项分布随机变量。

然而，

$$
\begin{align*}
P\{B(n,p)\geq v\}&=P\{n-B(n,p)\leq n-v\}\\
&=P\{B(n,1-p)\leq n-v\}
\end{align*}
$$ 

想想这是为什么？

所以根据 @eq-12_2_1，我们可以看出 $p-\text{value}$ 为：

$$
\begin{align*}
p-\text{value}&=2\min(P\{B(n,\frac{1}{2})\leq v\},P\{B(n,\frac{1}{2})\leq n-v\})\\
&=\begin{cases}2P\{B(n,\frac{1}{2})\leq v\}& \text{如果} v\leq\frac{n}{2}\\2P\{B(n,\frac{1}{2})\leq n-v\}& \text{如果} v\geq\frac{n}{2}\end{cases}
\end{align*}
$$ {#eq-12_2_2}

由于 $v=\sum_{i}I_1$ 的值取决于各项 $X_i - m_0$ 的符号，所以我们称如上的检验被为 **符号检验**（*sign test*）。

::: {#exr-12_2_a}
如果一个大小为 200 个样本中有 120 个数据小于 $m_0$，有 80 个数据大于 $m_0$，那么用于检验该样本总体的中位数等于 $m_0$ 的 $p-\text{value}$ 是多少？
:::

::: {#sol-12_2_a}
根据 @eq-12_2_2，检验的 $p-\text{value}$ 为参数为 $B(200, \frac{1}{2})$ 的伯努利随机变量小于等于 80 的概率的 2 倍。

```{r}
#| code-fold: false
#| warning: false

p_value <- 2 * pbinom(80, 200, 0.5)

p_value
```

因此，在 1% 的显著性水平下，我们将拒绝原假设。$\blacksquare$
:::

**符号检验** 也可以应用于之前的配对 $t-\text{检验}$ 的场景。例如，让我们回顾一下 @exr-8_4_c，该案例中希望检验最近制定的工业安全计划是否对因事故损失导致的工时数有影响。对于样本来源的 10 个工厂而言，数据对 $(X_i, Y_i)$ 表示工厂 $i$ 在实施安全计划前后的平均每周损失工时数。令 $Z_i = X_i - Y_i$，$i = 1,\ldots,10$，那么如果该计划没有任何效果，则 $Z_i$，$i = 1,\ldots,10$ 将是一个来自中位数为 0 的总体分布的样本。由于 $Z_i$ 的结果值为 7.5、-2.3、2.6、3.7、1.5、-0.5、-1、4.9、4.8、1.6，其中有三个值的符号为负，七个值的符号为正，所以在显著性水平 $\alpha$ 下，如果 $\sum_{i = 0}^{3}\binom{10}{i}\left(\frac{1}{2}\right)^{10}\leq\frac{\alpha}{2}$，那么我们应该拒绝 $Z$ 的中位数为 0 的假设。由于 $\sum_{i = 0}^{3}\binom{10}{i}\left(\frac{1}{2}\right)^{10}=\frac{176}{1024}=0.172$，所以在 5% 的显著性水平下，我们将接受该假设（实际上，在所有小于 0.344 的显著性水平下，我们都会接受原假设）。

因此，**符号检验** 不能使我们得出安全计划有任何统计上有显著影响的结论，而这与 @exr-8_4_c 中假设安全计划前后的差异数据服从正态分布得到的结论矛盾。原因在于正态分布的假设使得我们不仅考虑大于 0 的值的数量（这是符号检验所考虑的全部），而且还允许我们考虑这些值的大小。接下来要介绍的检验虽然仍然是非参数检验，但会通过考虑与假设的中位数 $m_0$ 的差异的大多数数据是否会倾向于位于 $m_0$ 的某一侧来改进 **符号检验**，即这些差异是否主要大于或小于 $m_0$。

我们也可以使用 **符号检验** 来检验关于总体中位数的单边检验。例如，假设我们要检验：

$H_0:m\leq m_0 \quad vs \quad H_1:m\gt m_0$

其中 $m$ 是总体中位数，$m_0$ 是某个特定值。令 $p$ 表示 $m$ 小于 $m_0$ 的概率，并且如果原假设为真，那么 $p\geq\frac{1}{2}$，如果备择假设为真，那么 $p\lt\frac{1}{2}$（参见 @fig-12_1）。

::: {#fig-12_1 layout-ncol=2}

![A](../images/chapter_12/f_12_1_1.png){#fig_12_1_1}

![B](../images/chapter_12/f_12_1_2.png){#fig_12_1_2}

![C](../images/chapter_12/f_12_1_3.png){#fig_12_1_3}

:::

为了使用 **符号检验** 来检验单边假设，我们从总体中随机选择 $n$ 个样本。如果其中有 $v$ 个样本的值小于 $m_0$，那么 $p-\text{value}$ 就是：如果每个元素小于 $m_0$ 的概率为 $\frac{1}{2}$，则存在 $v$（或更少） 个样本的概率。即，

$p-\text{value}=P\{B(n,\frac{1}{2})\leq v\}$

::: {#exr-12_2_b}
如果能确定某社区家庭的年收入中位数大于 90000 美元，则某家金融机构就会决定在该个社区开设办事处。为了获取相关信息，该金融机构随机选择了 80 个家庭，并记录了其家庭收入。如果其中 28 个家庭的年收入低于 90000 美元，52 个家庭的年收入高于 90000 美元，那么这是否足以说在 5% 的显著性水平下，该社区的家庭年收入中位数大于 90000 美元呢？
:::

::: {#sol-12_2_b}
对于如下的原假设：

$H_0:m\leq90 \quad vs \quad H_1:m\gt90$

我们需要确定当前的数据是否足以让我们拒绝原假设。

这等价于检验：

$H_0:p\geq\frac{1}{2} \quad vs \quad H_1:p\lt\frac{1}{2}$

其中 $p$ 是从总体中随机选择一个家庭其年收入小于 90000 美元的概率。因此，

$p-\text{value}=P(B(80,\frac{1}{2})\leq28)=\text{pbinom}(28,80,\frac{1}{2})=0.004841425$

所以我们将拒绝年收入中位数小于或等于 90000 美元的原假设。$\blacksquare$
:::

类似的，我们可以对中位数至少为 $m_0$ 的单边假设进行检验。如果选择一个大小为 $n$ 的随机样本，并且结果中有 $v$ 个值小于 $m_0$，那么 $p-\text{value}$ 为：

$p-\text{value}=P\{B(n,\frac{1}{2})\geq v\}$